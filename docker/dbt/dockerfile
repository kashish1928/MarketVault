FROM python:3.10-slim

WORKDIR /usr/app/dbt

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    build-essential \
    libpq-dev \
    && rm -rf /var/lib/apt/lists/*

# Install dbt and related packages directly
RUN pip install --no-cache-dir "dbt-core==1.7.9" \
    "dbt-postgres==1.7.9" \
    "psycopg2-binary" \
    "requests" \
    "numpy" \
    "yfinance==0.2.18" \
    "multitasking==0.0.9" \
    "pandas>=1.3.0,<2.0.0" \
    "sqlalchemy>=1.4,<2.0"

ENTRYPOINT ["dbt"]